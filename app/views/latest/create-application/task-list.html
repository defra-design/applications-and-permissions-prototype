{% extends "layouts/latest.html" %}



<!-- Setting the big main heading at the top of the page -->
{% set pageHeadingTextHTML %}
    Your animal disease movement licence application
{% endset %}



<!-- Text that show in the browser tab. Does NOT need changing -->
{% block pageTitle %}
    {{ pageHeadingTextHTML }}
{% endblock %}



{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

        <h1 class="govuk-heading-l">{{ pageHeadingTextHTML }}</h1>

        <p id="whole-text-progress-count" class="govuk-body">You have
            <span id="section-progress-count"></span> sections left to complete.
        </p>

        <p id="whole-text-all-complete" style="display: none;">All section are complete.</p>


        {{
            govukTaskList
            ({
                idPrefix: "company-details",
                items:
                [
                    {
                        title:
                        {
                            text: "What you plan to move and when"
                        },
                        href: "what/check-answers" if data['section-what-complete'] == "true" else "what/thing-being-moved",
                        status:
                        {
                            text: "Completed",
                            tag:
                            {
                                text: "Incomplete",
                                classes: "govuk-tag--blue"
                            } if data['section-what-complete'] != "true"
                        }
                    },



                    {
                        title:
                        {
                            text: "Movement origin"
                        },
                        href: "",
                        status:
                        {
                            text:  "Cannot start yet",
                            classes: "govuk-task-list__status--cannot-start-yet"
                        }
                    } if data['section-what-complete'] != "true",


                    {
                        title:
                        {
                            text: "Movement origin"
                        },
                        href: "origin/check-answers" if data['section-origin-complete'] == "true"  else "origin/to-or-from-own-premises",
                        status:
                        {
                            text: "Completed",
                            tag:
                            {
                                text: "Incomplete",
                                classes: "govuk-tag--blue"
                            } if data['section-origin-complete'] != "true"
                        }
                    } if data['section-what-complete'] == "true",




                    {
                        title:
                        {
                            text: "Movement destination"
                        },
                        href: "",
                        status:
                        {
                            text:  "Cannot start yet",
                            classes: "govuk-task-list__status--cannot-start-yet"
                        }
                    } if data['section-origin-complete'] != "true",


                    {
                        title:
                        {
                            text: "Movement destination"
                        },
                        href: "destination/check-answers" if data['section-origin-completesection-destination-complete'] == "true"  else "destination/routing-start",
                        status:
                        {
                            text: "Completed",
                            tag:
                            {
                                text: "Incomplete",
                                classes: "govuk-tag--blue"
                            } if data['section-origin-complete'] != "true"
                        }
                    } if data['section-origin-complete'] == "true",






                    {
                        title:
                        {
                            text: "Tests and vaccinations"
                        },
                        href: "tests/check-answers" if data['section-tests-complete'] == "true" else "tests/routing-tests",
                        status:
                        {
                            text: "Completed",
                            tag:
                            {
                                text: "Incomplete",
                                classes: "govuk-tag--blue"
                            } if data['section-tests-complete'] != "true"
                        }
                    },




                    {
                        title:
                        {
                            text: "Biosecurity details"
                        },
                        href: "biosecurity/check-answers" if data['section-biosecurity-complete'] == "true" else "biosecurity/kept-separately",
                        status:
                        {
                            text: "Completed",
                            tag:
                            {
                                text: "Incomplete",
                                classes: "govuk-tag--blue"
                            } if data['section-biosecurity-complete'] != "true"
                        }
                    } if      data['origin-to-or-from-own-premises-radios'] == "On the farm"
                           or data['destination-type-of-destination-radios'] == "A farm",


                    {
                        title:
                        {
                            text: "Biosecurity Map"
                        },
                        href: "PLACEHOLDER_URL_CHECK_ANSWERS/check-answers" if data['PLACEHOLDER_DATA_SECTION_COMPLETE'] == "true" else "PLACEHOLDER_FIRST_PAGE",
                        status:
                        {
                            text: "Completed",
                            tag:
                            {
                                text: "Incomplete",
                                classes: "govuk-tag--blue"
                            } if data['PLACEHOLDER_DATA_SECTION_COMPLETE'] != "true"
                        }
                    } if      data['origin-to-or-from-own-premises-radios'] == "On the farm"
                           or data['destination-type-of-destination-radios'] == "A farm",



                    {
                        title:
                        {
                            text: "Animal identification details"
                        },
                        href: "identification/check-answers" if data['section-identification-complete'] == "true" else "identification/microchipped",
                        status:
                        {
                            text: "Completed",
                            tag:
                            {
                                text: "Incomplete",
                                classes: "govuk-tag--blue"
                            } if data['section-identification-complete'] != "true"
                        }
                    } if  (data['origin-to-or-from-own-premises-radios'] == "On the farm"
                            and data['destination-type-of-destination-radios'] == "A farm")
                           or data['tests-whole-herd-test-radios-yes-no'] == "No",


                    {
                        title:
                        {
                            text: "Contact and updates"
                        },
                        href: "contact-and-updates/check-answers" if data['section-contact-and-updates-complete'] == "true" else "contact-and-updates/routing-contact-and-updates",
                        status:
                        {
                            text: "Completed",
                            tag:
                            {
                                text: "Incomplete",
                                classes: "govuk-tag--blue"
                            } if data['section-contact-and-updates-complete'] != "true"
                        }
                    }


                ]
            })
        }}



        <p>You can <a href="#">message the outbreak team</a> if you need help with your application.</p>


        <!-- go to routes.js for routing  -->
        <form action="#" method="post" novalidate>

            {{
                govukButton
                ({
                    text: "Review and submit",
                    classes: "govuk-button--secondary"
                })
            }}

        </form>

    </div>
</div>







<script>

    // Update the progress count
    window.onload = function ()
    {
        const elements = document.querySelectorAll('div.govuk-task-list__status');

        let numItems = elements.length;

        let completecounter = 0;

        elements.forEach((element) =>
        {
            var tagtext = element.textContent;

            if(tagtext.includes('Completed') )
            {
                completecounter++;
            }
        });

        let remaniningcount = numItems - completecounter;


        document.getElementById("section-progress-count").textContent = remaniningcount + "/" + numItems;


        // make button primary green if all done
        // also change text at the top
        if (completecounter == numItems)
        {
            const elementbutton = document.querySelector('.govuk-button');
            elementbutton.classList.remove('govuk-button--secondary');

            document.getElementById('whole-text-progress-count').style.display = 'none';
            document.getElementById('whole-text-all-complete').style.display = 'block';
        }


    }

</script>

{% endblock %}


